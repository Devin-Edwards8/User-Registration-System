#include <iostream>
#include <string>
#include <fstream>
#include <cstdlib>

using namespace std;

int main() {
    string answer, username, password, line;
    fstream data;
    bool success = false;
    
    cout << "New User? (yes or no) : ";
    cin >> answer;
    if(answer == "yes") {
        while(!success) {
            cout << "create a login\n";
            cout << "enter username\n";
            cin >> username;
        
            data.open("logins.txt", ios::in);
        
            bool user_exists = false;
            while(!data.eof()) {
                data >> line;
                if(line == username) {
                    user_exists = true;
                }
            }
            if(user_exists) {
                cout << "username taken, try again\n";
            } else {
                success = true;
            }
            data.close();
        }
        
        bool success = false;
        while(!success) {
            cout << "enter password\n";
            cin >> password;
            int test1, test2;
            bool number_pres = false, upper_pres = false;
        
            for(int i = 0; i < password.length(); i++) {
                test1 = isdigit(password[i]);
                test2 = isupper(password[i]);
                if(test1 != 0) {
                    number_pres = true;
                } else if(test2 != 0) {
                    upper_pres = true;
                }
            }
        
            if(!number_pres || !upper_pres) {
                cout << "password must have an upper case letter and a number. \n";
            } else {
                success = true;
            }
        }
        
        data.open("logins.txt", ios::app);
        
        data << username << "\n";
        data << password << "\n\n";
        
        data.close();
    } else if(answer == "no") {
        cout << "enter username\n";
        cin >> username;
        cout << "enter password\n";
        cin >> password;
        
        data.open("logins.txt", ios::in);
        
        bool founduser = false, password_correct = false;
        while(!data.eof()) {
            data >> line;
            if(line == username) {
                founduser = true;
                data >> line;
                if(line == password) {
                    password_correct = true;
                }
            }
        }
        if(founduser == false) {
            cout << "username does not exist\n";
        } else if(founduser == true && password_correct == false) {
            cout << "password incorrect\n";
        } else {
            cout << "Welcome back, " << username << "!\n";
        }
        
    } else {
        cout << "invalid input\n";
    }
    data.close();
    
    return 0;
}
